apply plugin: 'com.android.application'

android {
    compileSdkVersion 24
    buildToolsVersion '23.0.3'

    defaultConfig {
        applicationId "com.firstbuild.androidapp"
        minSdkVersion 19
        targetSdkVersion 22
        versionCode 4
        versionName "1.1.1"
        vectorDrawables.useSupportLibrary = true
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    aaptOptions {
        noCompress "ota"
    }

    applicationVariants.all { variant ->
        variant.outputs.each { output ->
            def apk = output.outputFile;
            def jenkinsUser = System.getProperty("user.name");
            def newName;
            if(jenkinsUser == "jenkins") {
                newName = "FirstBuild_${variant.versionName}_${new Date().format("MM-dd-yyyy")}.apk"
            }
            else {
                newName = "FirstBuild_${variant.versionName}.apk"
            }
            output.outputFile = new File(apk.parentFile, newName)
        }
    }

    gradle.buildFinished {
        moveApkToDeploy(this);
    }

}


def moveApkToDeploy(project) {
    def srcApkFolder = project.file("build/outputs/apk");
    def jenkinsUser = System.getProperty("user.name");
    def destPath;
    if(jenkinsUser == "jenkins") {
        destPath = "/Users/Shared/${System.getProperty("user.name")}/AutoGeneratedFile/Android/${project.parent.name}";
    }
    else {
        destPath = "/Users/${System.getProperty("user.name")}/Desktop/${project.parent.name}";
    }

    new File(destPath).mkdirs();

    File[] listOfFiles = srcApkFolder.listFiles();
    if (listOfFiles == null || listOfFiles.size() == 0)
        return;

    // move
    for (File f : listOfFiles) {
        if (f.isFile()) {
            println "target: ${f.getName()}"

            InputStream input = new FileInputStream(f);
            OutputStream output = new FileOutputStream(destPath + "/" + f.getName());

            byte[] buffer = new byte[1024];
            int length;

            while ((length = input.read(buffer)) > 0)
                output.write(buffer, 0, length);

            input.close();
            output.close();
        }
    }
}

repositories {
    maven { url "https://jitpack.io" }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile 'com.android.support:appcompat-v7:24.3.0'
    compile 'com.android.support:recyclerview-v7:24.3.0'
    compile 'com.getbase:floatingactionbutton:1.9.0'
    compile 'jp.wasabeef:recyclerview-animators:1.2.1'
    compile 'com.android.support:design:24.2.0'
    compile 'com.afollestad.material-dialogs:core:0.9.4.3'
    compile 'com.android.support:gridlayout-v7:24.2.0'
}
